# NEWStep Eng News - 기술 명세서

## 🏗️ 시스템 아키텍처

### 전체 시스템 구조
```
┌─────────────────────────────────────────────────────────────┐
│                    Frontend (React SPA)                     │
├─────────────────────────────────────────────────────────────┤
│                    Firebase Hosting                         │
├─────────────────────────────────────────────────────────────┤
│  Firebase Services  │  External APIs  │  Third-party       │
│  - Authentication   │  - News API     │  - Google AdSense  │
│  - Firestore DB     │  - Guardian API │  - Google Gemini   │
│  - Cloud Functions  │  - Gemini API   │  - Web Speech API  │
│  - Storage          │                 │                    │
└─────────────────────────────────────────────────────────────┘
```

### 기술 스택 상세

#### Frontend
```javascript
{
  "framework": "React 18.2.0",
  "bundler": "Vite 7.0.0",
  "ui_library": "Material-UI 7.1.2",
  "styling": "Styled-components 6.1.19",
  "routing": "React Router DOM 7.6.2",
  "state_management": "React Context API",
  "testing": {
    "unit": "Vitest 3.1.5",
    "e2e": "Playwright 1.53.1",
    "coverage": "@vitest/coverage-v8 3.2.4"
  }
}
```

#### Backend & Infrastructure
```javascript
{
  "backend": "Firebase",
  "database": "Firestore (NoSQL)",
  "authentication": "Firebase Auth + Google OAuth",
  "functions": "Firebase Cloud Functions",
  "storage": "Firebase Storage",
  "hosting": "Firebase Hosting",
  "cdn": "Firebase CDN"
}
```

#### External APIs
```javascript
{
  "news_sources": [
    "NewsAPI.org",
    "Guardian API"
  ],
  "ai_translation": "Google Gemini API",
  "text_to_speech": "Web Speech API",
  "monetization": "Google AdSense"
}
```

---

## 📊 데이터베이스 설계

### Firestore 컬렉션 구조

#### 1. Articles Collection
```javascript
// /articles/{articleId}
{
  id: "auto-generated-id",
  title: "Article Title",
  summary: "Article summary/description",
  content: "Full article content",
  url: "https://original-source.com/article",
  image: "https://image-url.com/image.jpg",
  category: "technology|science|business|culture|society",
  source: "BBC|CNN|Guardian|etc",
  publishedAt: "2024-01-15T10:00:00Z", // ISO 8601 format
  createdAt: "2024-01-15T10:00:00Z",
  updatedAt: "2024-01-15T10:00:00Z",
  status: "published|scheduled|draft",
  
  // 통계 데이터
  views: 0,
  likes: 0,
  
  // SEO 관련
  slug: "article-title-slug",
  tags: ["ai", "technology", "innovation"],
  
  // 예약 발행 관련
  actualPublishedAt: "2024-01-15T10:00:00Z" // 실제 발행 시간
}
```

#### 2. Users Collection
```javascript
// /users/{userId}
{
  uid: "firebase-user-id",
  email: "user@example.com",
  displayName: "User Name",
  photoURL: "https://profile-image.com/user.jpg",
  provider: "google.com",
  
  // 사용자 설정
  preferences: {
    language: "ko|en",
    theme: "light|dark",
    notifications: true,
    autoTranslate: true,
    speechRate: 1.0 // TTS 속도
  },
  
  // 학습 통계
  stats: {
    articlesRead: 0,
    wordsLearned: 0,
    totalStudyTime: 0, // 분 단위
    streak: 0, // 연속 학습 일수
    lastActiveDate: "2024-01-15"
  },
  
  createdAt: "2024-01-15T10:00:00Z",
  lastLoginAt: "2024-01-15T10:00:00Z"
}
```

#### 3. Wordbooks Collection
```javascript
// /users/{userId}/wordbooks/{wordId}
{
  word: "artificial",
  meaning: "인공의, 인위적인",
  pronunciation: "/ˌɑːrtɪˈfɪʃl/",
  partOfSpeech: "adjective",
  example: "Artificial intelligence is transforming industries.",
  translation: "인공지능이 산업을 변화시키고 있다.",
  
  // 학습 관련
  difficulty: "easy|medium|hard",
  mastered: false,
  reviewCount: 0,
  correctCount: 0,
  
  // 출처 정보
  sourceArticleId: "article-id",
  sourceTitle: "Article Title",
  
  createdAt: "2024-01-15T10:00:00Z",
  lastReviewedAt: "2024-01-15T10:00:00Z"
}
```

#### 4. Favorites Collection
```javascript
// /users/{userId}/favorites/{articleId}
{
  articleId: "article-id",
  title: "Article Title",
  summary: "Article summary",
  image: "https://image-url.com/image.jpg",
  category: "technology",
  addedAt: "2024-01-15T10:00:00Z"
}
```

#### 5. Config Collection
```javascript
// /config/categories
{
  list: [
    {
      id: "technology",
      name: "Technology",
      type: "category",
      color: "#d6eaff",
      enabled: true
    },
    // ... other categories
  ]
}

// /config/settings
{
  maintenance: false,
  featuredCategories: ["technology", "science"],
  maxArticlesPerCategory: 50,
  cacheTimeout: 300000 // 5분
}
```

---

## 🔧 핵심 기능 구현

### 1. 뉴스 데이터 수집 시스템

#### Enhanced News API Service
```javascript
// src/services/enhancedNewsApi.js
class EnhancedNewsAPI {
  constructor() {
    this.cache = new Map();
    this.cacheTTL = 5 * 60 * 1000; // 5분
    this.rateLimiter = {
      newsapi: { requests: 0, resetTime: 0 },
      guardian: { requests: 0, resetTime: 0 }
    };
  }

  // 다중 API 소스에서 뉴스 수집
  async fetchNews(options = {}) {
    const sources = ['newsapi', 'guardian'];
    const results = await Promise.allSettled(
      sources.map(source => this.fetchFromSource(source, options))
    );
    
    return this.mergeAndDeduplicateResults(results);
  }

  // 캐싱 시스템
  getCachedData(key) {
    const cached = this.cache.get(key);
    if (cached && Date.now() - cached.timestamp < this.cacheTTL) {
      return cached.data;
    }
    return null;
  }
}
```

### 2. AI 번역 시스템

#### Gemini API 통합
```javascript
// src/services/translationService.js
class TranslationService {
  constructor() {
    this.apiKey = import.meta.env.VITE_GEMINI_API_KEY;
    this.cache = new Map();
  }

  async translateText(text, targetLang = 'ko') {
    const cacheKey = `${text}_${targetLang}`;
    
    // 캐시 확인
    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey);
    }

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${this.apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{
            parts: [{
              text: `Translate the following English text to Korean naturally and accurately: "${text}"`
            }]
          }]
        })
      });

      const data = await response.json();
      const translation = data.candidates[0].content.parts[0].text;
      
      // 캐시 저장
      this.cache.set(cacheKey, translation);
      
      return translation;
    } catch (error) {
      console.error('Translation failed:', error);
      return '번역을 불러올 수 없습니다.';
    }
  }
}
```

### 3. 스마트 단어장 시스템

#### 단어 추출 및 저장
```javascript
// src/hooks/useWordbook.js
export const useWordbook = () => {
  const { user } = useAuth();
  
  const saveWord = async (word, context) => {
    if (!user) return;

    try {
      // 단어 정보 추출
      const wordInfo = await extractWordInfo(word, context);
      
      // Firestore에 저장
      const wordbookRef = collection(db, 'users', user.uid, 'wordbooks');
      await addDoc(wordbookRef, {
        ...wordInfo,
        createdAt: new Date().toISOString()
      });
      
      // 사용자 통계 업데이트
      await updateUserStats(user.uid, { wordsLearned: 1 });
      
    } catch (error) {
      console.error('Failed to save word:', error);
    }
  };

  const extractWordInfo = async (word, context) => {
    // 사전 API 또는 AI를 통한 단어 정보 추출
    return {
      word: word.toLowerCase(),
      meaning: await getMeaning(word),
      pronunciation: await getPronunciation(word),
      partOfSpeech: await getPartOfSpeech(word),
      example: context,
      difficulty: calculateDifficulty(word)
    };
  };
};
```

### 4. 음성 읽기 시스템

#### Text-to-Speech 구현
```javascript
// src/hooks/useSpeech.js
export const useSpeech = () => {
  const [speaking, setSpeaking] = useState(false);
  const [supported, setSupported] = useState(false);

  useEffect(() => {
    setSupported('speechSynthesis' in window);
  }, []);

  const speak = (text, options = {}) => {
    if (!supported) return;

    // 기존 음성 중지
    speechSynthesis.cancel();

    const utterance = new SpeechSynthesisUtterance(text);
    
    // 음성 설정
    utterance.lang = options.lang || 'en-US';
    utterance.rate = options.rate || 1.0;
    utterance.pitch = options.pitch || 1.0;
    utterance.volume = options.volume || 1.0;

    // 이벤트 핸들러
    utterance.onstart = () => setSpeaking(true);
    utterance.onend = () => setSpeaking(false);
    utterance.onerror = () => setSpeaking(false);

    speechSynthesis.speak(utterance);
  };

  const stop = () => {
    speechSynthesis.cancel();
    setSpeaking(false);
  };

  return { speak, stop, speaking, supported };
};
```

---

## 🔐 보안 및 인증

### Firebase Authentication 설정
```javascript
// src/config/firebase.js
import { initializeApp } from 'firebase/app';
import { getAuth, GoogleAuthProvider } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  // ... other config
};

const app = initializeApp(firebaseConfig);
export const auth = getAuth(app);
export const db = getFirestore(app);
export const googleProvider = new GoogleAuthProvider();
```

### Firestore 보안 규칙
```javascript
// firestore.rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 사용자는 자신의 데이터만 접근 가능
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // 단어장 접근 제어
      match /wordbooks/{wordId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
      
      // 즐겨찾기 접근 제어
      match /favorites/{favoriteId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }
    
    // 기사는 모든 사용자가 읽기 가능, 관리자만 쓰기 가능
    match /articles/{articleId} {
      allow read: if true;
      allow write: if request.auth != null && 
                      get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // 설정은 읽기만 가능
    match /config/{configId} {
      allow read: if true;
      allow write: if request.auth != null && 
                      get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
  }
}
```

---

## 📱 반응형 디자인 및 PWA

### 반응형 브레이크포인트
```javascript
// src/theme/breakpoints.js
export const breakpoints = {
  mobile: '320px',
  tablet: '768px',
  desktop: '1024px',
  wide: '1440px'
};

// 사용 예시
const ResponsiveContainer = styled.div`
  padding: 1rem;
  
  @media (min-width: ${breakpoints.tablet}) {
    padding: 2rem;
  }
  
  @media (min-width: ${breakpoints.desktop}) {
    padding: 3rem;
    max-width: 1200px;
    margin: 0 auto;
  }
`;
```

### PWA 설정
```javascript
// vite.config.js
import { VitePWA } from 'vite-plugin-pwa';

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg}']
      },
      manifest: {
        name: 'NEWStep Eng News',
        short_name: 'NEWStep',
        description: 'AI-powered English learning through news',
        theme_color: '#1976d2',
        background_color: '#ffffff',
        display: 'standalone',
        icons: [
          {
            src: 'icon-192x192.png',
            sizes: '192x192',
            type: 'image/png'
          },
          {
            src: 'icon-512x512.png',
            sizes: '512x512',
            type: 'image/png'
          }
        ]
      }
    })
  ]
});
```

---

## 🚀 성능 최적화

### 코드 분할 및 지연 로딩
```javascript
// src/App.jsx
import { lazy, Suspense } from 'react';

// 페이지별 코드 분할
const Home = lazy(() => import('./pages/Home'));
const ArticleDetail = lazy(() => import('./pages/ArticleDetail'));
const Wordbook = lazy(() => import('./pages/Wordbook'));

function App() {
  return (
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/article/:id" element={<ArticleDetail />} />
        <Route path="/wordbook" element={<Wordbook />} />
      </Routes>
    </Suspense>
  );
}
```

### 이미지 최적화
```javascript
// src/components/OptimizedImage.jsx
const OptimizedImage = ({ src, alt, ...props }) => {
  const [imageSrc, setImageSrc] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const img = new Image();
    img.onload = () => {
      setImageSrc(src);
      setLoading(false);
    };
    img.onerror = () => {
      setImageSrc('/placeholder-image.jpg');
      setLoading(false);
    };
    img.src = src;
  }, [src]);

  return (
    <>
      {loading && <ImageSkeleton />}
      {imageSrc && (
        <img
          src={imageSrc}
          alt={alt}
          loading="lazy"
          {...props}
        />
      )}
    </>
  );
};
```

### 캐싱 전략
```javascript
// src/utils/cache.js
class CacheManager {
  constructor() {
    this.cache = new Map();
    this.maxSize = 100;
    this.ttl = 5 * 60 * 1000; // 5분
  }

  set(key, value) {
    // LRU 캐시 구현
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }

    this.cache.set(key, {
      value,
      timestamp: Date.now()
    });
  }

  get(key) {
    const item = this.cache.get(key);
    if (!item) return null;

    // TTL 확인
    if (Date.now() - item.timestamp > this.ttl) {
      this.cache.delete(key);
      return null;
    }

    return item.value;
  }
}
```

---

## 📊 모니터링 및 분석

### 성능 모니터링
```javascript
// src/utils/performanceMonitor.js
class PerformanceMonitor {
  constructor() {
    this.metrics = new Map();
    this.observers = [];
    this.initWebVitals();
  }

  initWebVitals() {
    // Core Web Vitals 측정
    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
      getCLS(this.onVital.bind(this));
      getFID(this.onVital.bind(this));
      getFCP(this.onVital.bind(this));
      getLCP(this.onVital.bind(this));
      getTTFB(this.onVital.bind(this));
    });
  }

  onVital(metric) {
    // 성능 메트릭 수집
    this.metrics.set(metric.name, metric.value);
    
    // 임계값 초과 시 알림
    if (this.isThresholdExceeded(metric)) {
      this.reportPerformanceIssue(metric);
    }
  }

  startTiming(label) {
    performance.mark(`${label}-start`);
  }

  endTiming(label) {
    performance.mark(`${label}-end`);
    performance.measure(label, `${label}-start`, `${label}-end`);
    
    const measure = performance.getEntriesByName(label)[0];
    this.metrics.set(label, measure.duration);
  }
}
```

### 에러 추적
```javascript
// src/utils/errorReporter.js
class ErrorReporter {
  constructor() {
    this.setupGlobalErrorHandlers();
  }

  setupGlobalErrorHandlers() {
    // JavaScript 에러 추적
    window.addEventListener('error', (event) => {
      this.reportError({
        type: 'javascript',
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        stack: event.error?.stack
      });
    });

    // Promise rejection 추적
    window.addEventListener('unhandledrejection', (event) => {
      this.reportError({
        type: 'promise',
        message: event.reason?.message || 'Unhandled Promise Rejection',
        stack: event.reason?.stack
      });
    });
  }

  reportError(errorInfo) {
    // 개발 환경에서는 콘솔에 출력
    if (import.meta.env.DEV) {
      console.error('Error reported:', errorInfo);
      return;
    }

    // 프로덕션에서는 외부 서비스로 전송
    this.sendToErrorService(errorInfo);
  }
}
```

---

## 🔧 배포 및 CI/CD

### Firebase 배포 설정
```json
// firebase.json
{
  "hosting": {
    "public": "dist",
    "ignore": ["firebase.json", "**/.*", "**/node_modules/**"],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ],
    "headers": [
      {
        "source": "**/*.@(js|css)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "public, max-age=31536000, immutable"
          }
        ]
      }
    ]
  },
  "functions": {
    "source": "functions",
    "runtime": "nodejs18"
  }
}
```

### GitHub Actions CI/CD
```yaml
# .github/workflows/deploy.yml
name: Deploy to Firebase

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run tests
        run: npm run test:ci
      
      - name: Build project
        run: npm run build
        env:
          VITE_FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          VITE_GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      
      - name: Deploy to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}'
          projectId: your-project-id
```

---

## 📋 테스트 전략

### 단위 테스트
```javascript
// src/components/__tests__/AdCard.test.jsx
import { render, screen } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import AdCard from '../AdCard';

describe('AdCard', () => {
  it('renders advertisement label', () => {
    render(<AdCard showLabel={true} />);
    expect(screen.getByText('Advertisement')).toBeInTheDocument();
  });

  it('applies correct styling for wordbook ads', () => {
    render(<AdCard className="wordbook-ad" />);
    const adCard = screen.getByRole('article');
    expect(adCard).toHaveClass('wordbook-ad');
  });
});
```

### E2E 테스트
```javascript
// tests/e2e/article-detail.spec.js
import { test, expect } from '@playwright/test';

test('article detail page functionality', async ({ page }) => {
  await page.goto('/article/test-article-id');
  
  // 기사 제목 확인
  await expect(page.locator('h1')).toBeVisible();
  
  // 번역 기능 테스트
  await page.click('[data-testid="translate-button"]');
  await expect(page.locator('[data-testid="translated-content"]')).toBeVisible();
  
  // 음성 재생 테스트
  await page.click('[data-testid="play-button"]');
  await expect(page.locator('[data-testid="play-button"]')).toHaveAttribute('aria-pressed', 'true');
});
```

---

## 🔮 향후 기술 로드맵

### Phase 1: 현재 (MVP)
- ✅ React SPA 기반 웹 애플리케이션
- ✅ Firebase 백엔드 인프라
- ✅ 기본 AI 번역 및 TTS 기능
- ✅ Google AdSense 수익화

### Phase 2: 모바일 최적화 (3-6개월)
- 📱 React Native 모바일 앱
- 🔔 푸시 알림 시스템
- 📴 오프라인 모드 지원
- 🎯 개인화 추천 알고리즘

### Phase 3: AI 고도화 (6-12개월)
- 🤖 개인 맞춤 AI 튜터
- 📊 학습 패턴 분석
- 🎮 게임화 요소 추가
- 🗣️ 음성 인식 기능

### Phase 4: 글로벌 확장 (12-24개월)
- 🌏 다국어 지원 (일본어, 중국어)
- 🏢 B2B 기업 솔루션
- 📈 고급 분석 대시보드
- 🔗 외부 LMS 연동

---

이 기술 명세서는 NEWStep Eng News의 전체적인 기술 구조와 구현 방식을 상세히 설명합니다. 각 컴포넌트는 확장 가능하고 유지보수가 용이하도록 설계되었으며, 현대적인 웹 개발 베스트 프랙티스를 따릅니다.